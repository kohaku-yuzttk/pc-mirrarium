<!DOCTYPE html>
<html lang="ja">
<!-- Cormorant Garamond（Google Fonts／欧文） -->
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600&display=swap" rel="stylesheet">
<head>
  <meta charset="UTF-8">
  <title>うちの子ミラリウム</title>
  <link rel="icon" sizes="32x32" href="icon/favicon-48.png" type="image/png">
  <link rel="apple-touch-icon" href="icon/favicon-48.png">
  <link rel="stylesheet" href="style.css">
</head>
<header class="fixed-header">
	<div class="title-block">
		<div class="title-icon" id="menu-toggle">☰</div>
		<!--<img src="icon/favicon-48.png" alt="アイコン" class="title-icon"> -->
		<div class="header-title" id="header-title">うちの子ミラリウム</div>
	</div>
  <nav id="menu" style="display:none;">
    <ul>
      <li><a href="#tool">便利ツール</a></li>
      <!-- 他のセクションも追加可能 -->
    </ul>
  </nav>
</header>
<body>
<!-- 🏠 ホーム画面 -->
<section id="home">
  <div id="loading" class="loading-overlay">
    <div class="loading-text">ミラリウムを読み込んでいます…</div>
  </div>
  <div class="carousel" id="carousel"></div>
  <div class="search-area" id="search-area">
    <!-- 📝 一覧から探す -->
    <div class="search-block">
    	<span class="label">📝 一覧から探す</span>
    	<select id="sort-type">
      	<option value="yomi">名前</option>
      	<option value="age">年齢</option>
      	<option value="SAN_now">現在SAN</option>
      	<option value="SAN_ini">初期SAN</option>
      	<option value="STR">STR</option>
				<option value="CON">CON</option>
				<option value="POW">POW</option>
				<option value="DEX">DEX</option>
      	<option value="APP">APP</option>
				<option value="SIZ">SIZ</option>
				<option value="INT">INT</option>
				<option value="EDU">EDU</option>
				<option value="DB">DB</option>
    	</select>
    	<select id="sort-order">
      	<option value="asc">昇順</option>
      	<option value="desc">降順</option>
    	</select>
    	<button id="search-button">🔍</button>
    </div>
    <!-- 🎲 技能から探す -->
    <div class="search-block">
    	<span class="label">🎲 技能から探す</span>
    	<select id="search-skill" name="skill">
    	</select>
    	<select id="search-val">
		<option value="non">---</option>
      	<option value="30up">30以上</option>
      	<option value="50up">50以上</option>
		<option value="75up">75以上</option>
		<option value="90up">90以上</option>
    	</select>
    	<button id="search-button-by-skill">🔍</button>
    </div>
  	<!-- 🏷️ タグから探す -->
  	<div class="search-block">
    	<span class="label">🏷️ タグから探す</span>
    	<select id="search-tag" name="tag">
		<option value="non">---</option>
      	<option value="なし">なし</option>
      	<option value="ロスト">ロスト</option>
      	<option value="後遺症">後遺症</option>
    	</select>
		<button id="search-button-by-tag">🔍</button>
    </div>
  	<!-- 🖼️ 参加シナリオから探す -->
  	<div class="search-block">
    	<span class="label">🖼️ 参加シナリオから探す</span>
    	<input type="text" id="search-scenario" placeholder="シナリオ名を入力">
    	</select>
		<button id="search-button-by-scenario">🔍</button>
    </div>
  	<!-- 📄 HOから探す -->
  	<div class="search-block">
    	<span class="label">📄 HOから探す</span>
    	<input type="text" id="search-HO" placeholder="HO名を入力">
    	</select>
		<button id="search-button-by-HO">🔍</button>
    </div>
  	<!-- 👤 名前で探す -->
  	<div class="search-block">
    	<span class="label">👤 名前で探す</span>
    	<input type="text" id="search-name" placeholder="名前を入力">
    	<button id="search-button-by-name">🔍</button>
  	</div>
  </div>
</section>

<!-- 🔍 検索結果画面 -->
<section id="search" style="display:none;">
  <h2>検索結果</h2>
  <div class="search-container">
	  <table class="seeker-table">
  		<thead id="search-header"></thead>
  		<tbody id="search-results"></tbody>
	  </table>
  </div>
  <button id="back-home">←ホームに戻る</button>
</section>

<!-- 👤 探索者詳細画面 -->
<section id="detail" style="display:none;">
	<div class="detail-container">
    	<div class="name-block">
			<p id="name"></p>
			<div id="tags"></div>
		</div>
		<div class="detail-block">
			<div class="detail-header">
  				<div class="portrait-block">
    				<div id="portrait-wrapper"><img id="portrait" class="portrait"></div>
    				<p id="sheet-url"><a href="#" target="_blank">キャラシートを見る</a></p>
						<div class="meta-info">
							<p>PL: <span id="pl"></span></p>
							<span id="image_maker"></span>
						</div>
  				</div>
  				<div class="basic-info">
    				<h2>基本データ</h2>
    				<p>職業：<span id="occupation"></span></p>
    				<p>年齢：<span id="age"></span></p>
						<p>誕生日：<span id="birthday"></span></span></p>
						<p id="color-tags">イメージカラー<span class="c-tags" id="color-tag"></span></p>
						<p>HP: <span id="HP"></span>　MP: <span id="MP"></span></p>
						<p>DB: <span id="DB"></span></p>
						<p>SAN: <span id="SAN_now"></span> / <span id="SAN_ini"></span></p>
					
  					<div class="status-block">
    					<h2>能力値</h2>
    					<ul id="status-list"></ul>
  					</div>
 				</div>
				<div class="relationship-block">
  					<h3>関係性</h3>
  					<div class="relationship-list">
  					</div>
				</div>
				<div class="skill-block">
					<h2>技能値</h2>
					<div id="skill-list" class="skill-table"></div>
				</div>
				<div class="voice-block">
					<h3>ボイス情報</h3>
					<div class="voice-partition">
						<div class="voice-info">
  						<div class="voice-slider"><label>高さ： 低</label><input type="range" min="0" max="100" value="50" id="voice-h" disabled><label>高</label></div>
  						<div class="voice-slider"><label>速さ： 遅</label><input type="range" min="0" max="100" value="50" id="voice-s" disabled><label>速</label></div>
  						<div class="voice-slider"><label>位置： 胸</label><input type="range" min="0" max="100" value="50" id="voice-p" disabled><label>鼻</label></div>
  						<div class="voice-slider"><label>息　： 少</label><input type="range" min="0" max="100" value="50" id="voice-w" disabled><label>多</label></div>
							<div class="voice-slider"><label>抑揚： 無</label><input type="range" min="0" max="100" value="50" id="voice-e" disabled><label>有</label></div>
						</div>
						<div class="voice-samples">
    					<h3>サンプルボイス</h3>
							<div class="voice-line" id="voice-line"></div>
    					<audio id="voice-player"></audio>
  					</div>
					</div>
				</div>
			</div>
		
  			<div class="timeline-block">
  				<h2>通過シナリオ</h2>
  				<ul id="scenario-timeline" class="timeline"></ul>
  			</div>
		</div>
	</div>
  <button class="back-button">戻る</button>
</section>
<!-- ツール案内ページ -->
<section id="tool" style="display:none;">
	<h2>ツール</h2>
	<p>このページでは、うちの子ミラリウムでの記録や整理を助ける便利なツールをご紹介します。  </p>
	<div class="tool-container">
		<div class="tool-block">
			<h2>チャットパレット生成ブックマークレット</h2>
			<p>キャラクター保管所のキャラシートから、チャットパレットを自動生成してクリップボードにコピーするツールです。</p>

			<ol>
  			<li>ブラウザのブックマークを新規作成</li>
  			<li>名前を「キャラクター保管所チャットパレット生成」などに設定</li>
				<li>URL欄に以下のコードを貼り付けて保存</li>
				<li>キャラクター保管所のキャラシートを開く</li>
				<li>追加したブックマークをクリックする</li>
				<li>チャットパレットが自動生成され、クリップボードにコピーされます。</li>
			</ol>

			<div class="code-block">
			<button class="copy-button">コピー</button>
			<pre>
				<code id="bookmarklet-code">
					javascript:void(function(){ try { if (location.hostname !== 'charasheet.vampire-blood.net') { alert('このサイトでは使用できません'); return; } /** 技能名取得関数（3種の構造に対応） */ function getSkillName(cell) { const input = cell.querySelector('input'); if (input && cell.childNodes.length === 1) { return input.value.trim(); /** 種類③：inputのみ */ } if (input && cell.childNodes.length > 1) { const base = cell.childNodes[0]?.textContent?.trim() || %27%27; const suffix = input.value.trim(); return suffix ? `${base}(${suffix})` : base; /** 種類②：補足あり */ } return cell.textContent.trim(); /** 種類①：テキストのみ */ } let chatPalette = %27%27; const idea = parseInt(document.getElementById(%27NP12%27)?.value || %270%27, 10); const luck = parseInt(document.getElementById(%27NP13%27)?.value || %270%27, 10); const knowledge = parseInt(document.getElementById(%27NP14%27)?.value || %270%27, 10); chatPalette += `\nCCB<=${idea} アイデア`; chatPalette += `\nCCB<=${luck} 幸運`; chatPalette += `\nCCB<=${knowledge} 知識`; /** 技能テーブル一覧 */ const tables = [ %27Table_battle_arts%27, %27Table_find_arts%27, %27Table_act_arts%27, %27Table_commu_arts%27, %27Table_know_arts%27 ]; tables.forEach(id => { const table = document.getElementById(id); if (!table) return; for (let i = 1; i < table.rows.length; i++) { const row = table.rows[i]; const cell = row.cells[1]; const ini = row.cells[2]?.children[0]?.value; const sum = row.cells[7]?.children[0]?.value; if (ini !== sum) { const name = getSkillName(cell); chatPalette += `\nCCB<=${sum} ${name}`; } } }); /** クリップボードにコピー */ const listener = function(e) { e.clipboardData.setData(%27text/plain%27, chatPalette); e.preventDefault(); document.removeEventListener(%27copy%27, listener); }; document.addEventListener(%27copy%27, listener); document.execCommand(%27copy%27); /** 完了メッセージ */ alert(%27チャットパレットをクリップボードにコピーしました%27); } catch(e) { alert(%27失敗しました\n%27 + e); } })();
				</code>
			</pre>
		</div>
		<div class="tool-block">
			<h2>今後追加予定のツール</h2>
			<ul>
				<li>キャラクター保管所PCココフォリア駒作成ツール</li>
				<li>意味はないけどダイスロールしたい！</li>
				<li>その他、便利なツールを随時追加予定</li>
			</ul>
			<p>ご要望やアイデアがありましたら、お気軽にお問い合わせください。</p>
		</div>
	</div>
  <button class="back-button">戻る</button>
</section>
<!-- JavaScript -->
<script src="script.js"></script>
<script>
  window.addEventListener('DOMContentLoaded', initCarousel);
</script>
<script>
  document.getElementById('menu-toggle').addEventListener('click', function() {
    const menu = document.getElementById('menu');
    menu.style.display = (menu.style.display === 'none') ? 'block' : 'none';
  });

  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function(e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({ behavior: 'smooth' });
        document.getElementById('menu').style.display = 'none'; /** メニューを閉じる */
      }
			showScreen('tool');
    });
  });
</script>
<script>
  document.querySelector('.copy-button').addEventListener('click', function() {
    const code = document.getElementById('bookmarklet-code').innerText;
    navigator.clipboard.writeText(code).then(() => {
      this.textContent = 'コピーしました';
      setTimeout(() => this.textContent = 'コピー', 2000);
    });
  });
</script>
</body>
<footer class="copyright">
  <p>
    本サイトは、「株式会社アークライト」及び「株式会社KADOKAWA」が権利を有する<br>
    『クトゥルフ神話TRPG』の二次創作物です。<br><br>
    Call of Cthulhu is copyright ©1981, 2015, 2019 by Chaosium Inc.; all rights reserved.<br>
    Arranged by Arclight Inc. Call of Cthulhu is a registered trademark of Chaosium Inc.<br>
    PUBLISHED BY KADOKAWA CORPORATION
  </p>
</footer>
</html>
